<header class="p-4">
  <h1 class="text-3xl font-bold">Ration de croquettes</h1>
</header>

<main class="p-4">
  <form class="flex flex-col gap-12" [formGroup]="formGroup">
    <div class="flex flex-col gap-2">
      <div class="flex items-center gap-4">
        <label for="splittingCount">Fractionner en</label>

        <p-inputNumber
          inputId="splittingCount"
          [min]="1"
          [max]="12"
          suffix=" fois"
          [showButtons]="true"
          buttonLayout="horizontal"
          incrementButtonIcon="pi pi-plus"
          decrementButtonIcon="pi pi-minus"
          formControlName="splittingCount"
        ></p-inputNumber>
      </div>

      <p-checkbox
        *ngIf="formGroup.getRawValue().splittingCount > 1"
        [binary]="true"
        label="Répartition personnalisée"
        formControlName="customDistribution"
      ></p-checkbox>
    </div>

    <div>
      <h2 class="underline mb-2">Fractionnement{{ formGroup.getRawValue().splittingCount > 1 ? "s" : "" }}</h2>

      <div class="flex flex-col gap-4">
        <div
          class="flex items-center gap-4"
          *ngFor="let splittingControl of formGroup.controls.splittings.controls; let i = index"
        >
          <label [for]="'splitting-' + i">{{ i + 1 }}.</label>

          <p-inputNumber
            [inputId]="'splitting-' + i"
            [min]="1"
            [max]="10"
            [showButtons]="true"
            buttonLayout="horizontal"
            incrementButtonIcon="pi pi-plus"
            decrementButtonIcon="pi pi-minus"
            [formControl]="splittingControl"
          ></p-inputNumber>
        </div>
      </div>
    </div>

    <div>
      <h2 class="underline mb-2">Quantité{{ formGroup.controls.dailyQuantities.length > 1 ? "s" : "" }} journalière</h2>

      <div class="flex flex-col gap-4">
        <div
          class="flex items-center gap-4"
          *ngFor="let dailyQuantityGroup of formGroup.controls.dailyQuantities.controls; let i = index; let last = last"
          [formGroup]="dailyQuantityGroup"
        >
          <label [for]="'daily-quantity-' + i">{{ i + 1 }}.</label>

          <div class="flex flex-col gap-2">
            <p-inputNumber
              [inputId]="'daily-quantity-' + i"
              [min]="1"
              [max]="1000"
              [step]="5"
              suffix=" gr"
              [showButtons]="true"
              buttonLayout="horizontal"
              incrementButtonIcon="pi pi-plus"
              decrementButtonIcon="pi pi-minus"
              formControlName="quantity"
            ></p-inputNumber>

            <div class="flex items-center gap-4">
              <label [for]="'distribution-' + i">Répartition</label>

              <p-inputNumber
                class="distribution"
                [inputId]="'distribution-' + i"
                [min]="0"
                [max]="100"
                [step]="10"
                suffix=" %"
                formControlName="distribution"
              ></p-inputNumber>
            </div>
          </div>

          <p-button
            *ngIf="formGroup.controls.dailyQuantities.length > 1"
            styleClass="p-button-outlined p-button-rounded p-button-text p-button-danger"
            icon="pi pi-trash"
            (onClick)="removeDailyQuantityAt(i)"
          ></p-button>

          <p-button
            *ngIf="last"
            styleClass="p-button-outlined p-button-rounded p-button-text"
            icon="pi pi-plus"
            (onClick)="addDailyQuantity()"
          ></p-button>
        </div>
      </div>
    </div>

    <p-table [value]="(splittedDailyQuantities$ | async)!">
      <ng-template pTemplate="caption">Résultats</ng-template>

      <ng-template pTemplate="header">
        <tr>
          <th></th>

          <th *ngFor="let dailyQuantity of formGroup.getRawValue().dailyQuantities; let i = index">Qté. {{ i + 1 }}</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-splittedDailyQuantities let-rowIndex="rowIndex">
        <tr>
          <td>{{ rowIndex + 1 }}.</td>

          <td *ngFor="let splittedDailyQuantity of splittedDailyQuantities">
            {{ splittedDailyQuantity | number : "1.0-1" }} gr
          </td>
        </tr>
      </ng-template>
    </p-table>
  </form>
</main>
